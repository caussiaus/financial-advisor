
        <!DOCTYPE html>
        <html>
        <head>
            <title>Story-Driven Financial Journey</title>
            <script src="https://d3js.org/d3.v7.min.js"></script>
            <style>
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    margin: 20px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                }
                .container {
                    max-width: 1400px;
                    margin: 0 auto;
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                    overflow: hidden;
                }
                .header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 30px;
                    text-align: center;
                }
                .header h1 {
                    margin: 0;
                    font-size: 2.5em;
                    font-weight: 300;
                }
                .header p {
                    margin: 10px 0 0 0;
                    opacity: 0.9;
                    font-size: 1.1em;
                }
                .content {
                    padding: 30px;
                }
                .story-timeline {
                    width: 100%;
                    height: 600px;
                    background: white;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                .legend {
                    display: flex;
                    justify-content: center;
                    gap: 20px;
                    margin: 20px 0;
                    flex-wrap: wrap;
                }
                .legend-item {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 14px;
                    font-weight: 500;
                }
                .legend-red {
                    background: rgba(214, 39, 40, 0.1);
                    color: #d62728;
                    border: 2px solid #d62728;
                }
                .legend-grey {
                    background: rgba(127, 127, 127, 0.1);
                    color: #7f7f7f;
                    border: 2px solid #7f7f7f;
                }
                .legend-green {
                    background: rgba(44, 160, 44, 0.1);
                    color: #2ca02c;
                    border: 2px solid #2ca02c;
                }
                .legend-orange {
                    background: rgba(255, 127, 14, 0.1);
                    color: #ff7f0e;
                    border: 2px solid #ff7f0e;
                }
                .tooltip {
                    position: absolute;
                    background: rgba(0,0,0,0.9);
                    color: white;
                    padding: 12px;
                    border-radius: 8px;
                    font-size: 12px;
                    pointer-events: none;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    z-index: 1000;
                }
                .decision-node {
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                .decision-node:hover {
                    transform: scale(1.1);
                }
                .path-line {
                    stroke-width: 3;
                    opacity: 0.7;
                    transition: opacity 0.3s ease;
                }
                .path-line:hover {
                    opacity: 1;
                    stroke-width: 5;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>ðŸŽ® Story-Driven Financial Journey</h1>
                    <p>Interactive visualization of decision branches and their consequences</p>
                </div>
                
                <div class="content">
                    <div class="legend">
                        <div class="legend-item legend-red">
                            <div style="width: 12px; height: 12px; background: #d62728; border-radius: 50%;"></div>
                            Feasible Paths (Red)
                        </div>
                        <div class="legend-item legend-grey">
                            <div style="width: 12px; height: 12px; background: #7f7f7f; border-radius: 50%;"></div>
                            Closed Paths (Grey)
                        </div>
                        <div class="legend-item legend-green">
                            <div style="width: 12px; height: 12px; background: #2ca02c; border-radius: 50%;"></div>
                            Optimal Choices (Green)
                        </div>
                        <div class="legend-item legend-orange">
                            <div style="width: 12px; height: 12px; background: #ff7f0e; border-radius: 50%;"></div>
                            Chosen Paths (Orange)
                        </div>
                    </div>
                    
                    <div class="story-timeline"></div>
                </div>
            </div>
            
            <script>
                // Story data from Python
                const storyData = {"decision_points": [{"timestamp": "2021-03-15", "event_type": "career_advancement", "description": "You have been offered a promotion with higher pay but more responsibility"}, {"timestamp": "2022-06-01", "event_type": "family_planning", "description": "You are expecting your first child and need to plan for increased expenses"}], "available_paths": [{"decision_point": "career_advancement", "path_type": "aggressive", "description": "Take the promotion with higher risk", "risk_level": "high", "portfolio_impact": {"equity_increase": 0.15}, "life_impact": {"income_increase": 0.2}, "status": "available"}, {"decision_point": "career_advancement", "path_type": "conservative", "description": "Stay in current role", "risk_level": "low", "portfolio_impact": {"risk_reduction": 0.1}, "life_impact": {"stress_reduction": 0.1}, "status": "available"}, {"decision_point": "career_advancement", "path_type": "balanced", "description": "Negotiate a middle ground", "risk_level": "medium", "portfolio_impact": {"equity_increase": 0.05}, "life_impact": {"income_increase": 0.1, "stress_reduction": 0.05}, "status": "available"}, {"decision_point": "family_planning", "path_type": "conservative", "description": "Increase emergency fund and reduce risk", "risk_level": "low", "portfolio_impact": {"risk_reduction": 0.2}, "life_impact": {"stress_reduction": 0.2}, "status": "available"}, {"decision_point": "family_planning", "path_type": "maintain", "description": "Keep current allocation", "risk_level": "medium", "portfolio_impact": {}, "life_impact": {}, "status": "available"}], "closed_paths": [], "optimal_choices": [{"decision_point": "career_advancement", "choice_type": "balanced", "description": "Negotiate a middle ground", "highlighted": true}, {"decision_point": "family_planning", "choice_type": "conservative", "description": "Increase emergency fund and reduce risk", "highlighted": true}], "chosen_paths": [{"decision_point": "career_advancement", "chosen_type": "balanced", "optimal_type": "balanced", "was_optimal": true}, {"decision_point": "family_planning", "chosen_type": "conservative", "optimal_type": "conservative", "was_optimal": true}], "portfolio_impacts": [{"decision_point": "career_advancement", "equity_change": 0.05, "risk_change": 0, "impact_type": "positive"}, {"decision_point": "family_planning", "equity_change": 0, "risk_change": 0.2, "impact_type": "positive"}], "life_impacts": [{"decision_point": "career_advancement", "stress_change": 0.05, "income_change": 0.1, "impact_type": "positive"}, {"decision_point": "family_planning", "stress_change": 0.2, "income_change": 0, "impact_type": "positive"}]};
                
                // D3.js Story-Driven Visualization
                const margin = {top: 20, right: 20, bottom: 20, left: 20};
                const width = 1360 - margin.left - margin.right;
                const height = 560 - margin.top - margin.bottom;
                
                const svg = d3.select(".story-timeline")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                // Create decision timeline
                const decisionPoints = storyData.decision_points;
                const availablePaths = storyData.available_paths;
                const closedPaths = storyData.closed_paths;
                const optimalChoices = storyData.optimal_choices;
                const chosenPaths = storyData.chosen_paths;
                
                // Create scales
                const xScale = d3.scaleLinear()
                    .domain([0, decisionPoints.length - 1])
                    .range([0, width]);
                
                const yScale = d3.scaleLinear()
                    .domain([0, 100])
                    .range([height, 0]);
                
                // Create decision nodes
                const decisionNodes = svg.selectAll(".decision-node")
                    .data(decisionPoints)
                    .enter()
                    .append("circle")
                    .attr("class", "decision-node")
                    .attr("cx", (d, i) => xScale(i))
                    .attr("cy", height / 2)
                    .attr("r", 15)
                    .style("fill", "#1f77b4")
                    .style("stroke", "#000")
                    .style("stroke-width", 2);
                
                // Add decision labels
                svg.selectAll(".decision-label")
                    .data(decisionPoints)
                    .enter()
                    .append("text")
                    .attr("class", "decision-label")
                    .attr("x", (d, i) => xScale(i))
                    .attr("y", height / 2 + 30)
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("font-weight", "bold")
                    .text(d => d.event_type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
                
                // Create available paths (red)
                const availablePathNodes = svg.selectAll(".available-node")
                    .data(availablePaths)
                    .enter()
                    .append("circle")
                    .attr("class", "available-node")
                    .attr("cx", (d, i) => xScale(i % decisionPoints.length) + (i % 3 - 1) * 30)
                    .attr("cy", height / 2 - 80)
                    .attr("r", 8)
                    .style("fill", "#d62728")
                    .style("stroke", "#000")
                    .style("stroke-width", 1);
                
                // Create closed paths (grey)
                const closedPathNodes = svg.selectAll(".closed-node")
                    .data(closedPaths)
                    .enter()
                    .append("circle")
                    .attr("class", "closed-node")
                    .attr("cx", (d, i) => xScale(i % decisionPoints.length) + (i % 3 - 1) * 30)
                    .attr("cy", height / 2 + 80)
                    .attr("r", 8)
                    .style("fill", "#7f7f7f")
                    .style("stroke", "#000")
                    .style("stroke-width", 1);
                
                // Create optimal choices (green)
                const optimalNodes = svg.selectAll(".optimal-node")
                    .data(optimalChoices)
                    .enter()
                    .append("circle")
                    .attr("class", "optimal-node")
                    .attr("cx", (d, i) => xScale(i) + 50)
                    .attr("cy", height / 2)
                    .attr("r", 12)
                    .style("fill", "#2ca02c")
                    .style("stroke", "#000")
                    .style("stroke-width", 2);
                
                // Create chosen paths (orange/red)
                const chosenNodes = svg.selectAll(".chosen-node")
                    .data(chosenPaths)
                    .enter()
                    .append("circle")
                    .attr("class", "chosen-node")
                    .attr("cx", (d, i) => xScale(i) + 100)
                    .attr("cy", height / 2)
                    .attr("r", 10)
                    .style("fill", d => d.was_optimal ? "#ff7f0e" : "#d62728")
                    .style("stroke", "#000")
                    .style("stroke-width", 2);
                
                // Create path connections
                const pathConnections = svg.selectAll(".path-line")
                    .data(availablePaths)
                    .enter()
                    .append("line")
                    .attr("class", "path-line")
                    .attr("x1", (d, i) => xScale(i % decisionPoints.length))
                    .attr("y1", height / 2)
                    .attr("x2", (d, i) => xScale(i % decisionPoints.length) + (i % 3 - 1) * 30)
                    .attr("y2", height / 2 - 80)
                    .style("stroke", "#d62728")
                    .style("stroke-width", 2);
                
                // Create tooltip
                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);
                
                // Add hover effects
                decisionNodes.on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>Decision Point</strong><br/>${d.event_type.replace(/_/g, ' ')}<br/>${d.description}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
                
                availablePathNodes.on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>Available Path</strong><br/>${d.path_type}<br/>${d.description}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
                
                closedPathNodes.on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>Closed Path</strong><br/>${d.path_type}<br/>Reason: ${d.reason}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
                
                console.log("Story-driven financial journey visualization loaded");
            </script>
        </body>
        </html>
        