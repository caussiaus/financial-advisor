
        <!DOCTYPE html>
        <html>
        <head>
            <title>IPS Parallel Sets Analysis</title>
            <script src="https://d3js.org/d3.v7.min.js"></script>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    margin: 20px;
                    background-color: #f5f5f5;
                }
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    background: white;
                    padding: 20px;
                    border-radius: 8px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                }
                .parallel-sets {
                    width: 100%;
                    height: 600px;
                }
                .axis {
                    font-size: 12px;
                }
                .axis path,
                .axis line {
                    fill: none;
                    stroke: #000;
                    shape-rendering: crispEdges;
                }
                .ribbon {
                    fill-opacity: 0.7;
                    stroke: #000;
                    stroke-width: 0.5px;
                }
                .ribbon:hover {
                    fill-opacity: 0.9;
                }
                .tooltip {
                    position: absolute;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    pointer-events: none;
                }
                .controls {
                    margin-bottom: 20px;
                    padding: 15px;
                    background: #f8f9fa;
                    border-radius: 5px;
                }
                .filter-btn {
                    margin: 5px;
                    padding: 8px 15px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    background: #007bff;
                    color: white;
                }
                .filter-btn:hover {
                    background: #0056b3;
                }
                .filter-btn.active {
                    background: #28a745;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>IPS Analysis: Parallel Sets Visualization</h1>
                <p>This visualization shows the relationships between life events, portfolio allocations, market conditions, comfort levels, and performance outcomes.</p>
                
                <div class="controls">
                    <h3>Filters:</h3>
                    <button class="filter-btn active" data-filter="all">Show All</button>
                    <button class="filter-btn" data-filter="positive">Positive Events Only</button>
                    <button class="filter-btn" data-filter="negative">Negative Events Only</button>
                    <button class="filter-btn" data-filter="high-impact">High Impact Only</button>
                </div>
                
                <div class="parallel-sets"></div>
            </div>
            
            <script>
                // Data from Python
                const setsData = {"life_events": [{"category": "family_planning", "impact": "Medium", "direction": "Negative", "date": "2020-03-15"}, {"category": "career_advancement", "impact": "Medium", "direction": "Positive", "date": "2021-01-15"}, {"category": "portfolio_rebalancing", "impact": "Low", "direction": "Positive", "date": "2022-06-01"}, {"category": "education_planning", "impact": "Low", "direction": "Negative", "date": "2023-09-01"}, {"category": "education_decision", "impact": "Medium", "direction": "Positive", "date": "2024-02-15"}, {"category": "work_arrangement", "impact": "Medium", "direction": "Negative", "date": "2025-01-01"}], "portfolio_allocations": ["Balanced", "Balanced", "Balanced", "Balanced", "Balanced", "Balanced"], "market_conditions": ["Low Stress", "Low Stress", "Low Stress", "Low Stress", "Low Stress", "Low Stress"], "comfort_levels": ["High Comfort", "High Comfort", "High Comfort", "High Comfort", "High Comfort", "High Comfort"], "performance_outcomes": ["High Performance", "High Performance", "High Performance", "High Performance", "High Performance", "High Performance"]};
                
                // D3.js Parallel Sets Implementation
                const margin = {top: 20, right: 20, bottom: 20, left: 20};
                const width = 1160 - margin.left - margin.right;
                const height = 560 - margin.top - margin.bottom;
                
                const svg = d3.select(".parallel-sets")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                // Create dimensions
                const dimensions = [
                    'life_events',
                    'portfolio_allocations', 
                    'market_conditions',
                    'comfort_levels',
                    'performance_outcomes'
                ];
                
                // Create scales for each dimension
                const scales = {};
                dimensions.forEach((dim, i) => {
                    const uniqueValues = [...new Set(setsData[dim].map(d => 
                        typeof d === 'object' ? d.category : d
                    ))];
                    scales[dim] = d3.scalePoint()
                        .domain(uniqueValues)
                        .range([0, height]);
                });
                
                // Create axes
                const axes = svg.selectAll(".axis")
                    .data(dimensions)
                    .enter()
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", (d, i) => "translate(" + (i * width / (dimensions.length - 1)) + ",0)");
                
                axes.append("line")
                    .attr("y1", 0)
                    .attr("y2", height);
                
                axes.append("text")
                    .attr("x", -6)
                    .attr("y", height + 6)
                    .attr("text-anchor", "end")
                    .text(d => d.replace(/_/g, ' ').replace(/\w/g, l => l.toUpperCase()));
                
                // Add category labels
                dimensions.forEach((dim, i) => {
                    const uniqueValues = [...new Set(setsData[dim].map(d => 
                        typeof d === 'object' ? d.category : d
                    ))];
                    
                    const axis = svg.selectAll(".axis").filter((d, j) => j === i);
                    
                    axis.selectAll(".category")
                        .data(uniqueValues)
                        .enter()
                        .append("text")
                        .attr("class", "category")
                        .attr("x", -6)
                        .attr("y", d => scales[dim](d))
                        .attr("text-anchor", "end")
                        .text(d => d);
                });
                
                // Create tooltip
                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);
                
                // Add filter functionality
                d3.selectAll(".filter-btn").on("click", function() {
                    const filter = d3.select(this).attr("data-filter");
                    
                    // Update active button
                    d3.selectAll(".filter-btn").classed("active", false);
                    d3.select(this).classed("active", true);
                    
                    // Apply filter logic here
                    console.log("Filter applied:", filter);
                });
                
                // Add sample ribbons (simplified for demo)
                const ribbonData = [];
                for (let i = 0; i < Math.min(setsData.life_events.length, 5); i++) {
                    ribbonData.push({
                        source: setsData.life_events[i].category,
                        target: setsData.portfolio_allocations[i],
                        value: 1,
                        color: setsData.life_events[i].direction === 'Positive' ? '#2ca02c' : '#d62728'
                    });
                }
                
                // Draw sample ribbons
                ribbonData.forEach((ribbon, i) => {
                    const x1 = 0;
                    const y1 = scales.life_events(ribbon.source);
                    const x2 = width / (dimensions.length - 1);
                    const y2 = scales.portfolio_allocations(ribbon.target);
                    
                    const line = d3.line()
                        .x(d => d.x)
                        .y(d => d.y)
                        .curve(d3.curveBasis);
                    
                    const pathData = [
                        {x: x1, y: y1},
                        {x: x2, y: y2}
                    ];
                    
                    svg.append("path")
                        .datum(pathData)
                        .attr("class", "ribbon")
                        .attr("d", line)
                        .style("stroke", ribbon.color)
                        .style("stroke-width", 3)
                        .style("fill", "none")
                        .on("mouseover", function(event, d) {
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(`Source: ${ribbon.source}<br/>Target: ${ribbon.target}<br/>Value: ${ribbon.value}`)
                                .style("left", (event.pageX + 5) + "px")
                                .style("top", (event.pageY - 28) + "px");
                        })
                        .on("mouseout", function(d) {
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        });
                });
            </script>
        </body>
        </html>
        